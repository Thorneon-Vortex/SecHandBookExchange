
### **大作业题目设计方案**

**题目名称：** **校园二手书交易与分享平台**

**题目简介：**
设计并实现一个面向大学校园的二手书交易与分享系统。学生可以在平台上发布自己闲置的书籍信息（出售或赠送），也可以搜索、浏览并购买或申请获赠自己需要的书籍。系统旨在促进校园内书籍资源的循环利用，方便学生之间的书籍交流。

**为什么选这个题目？**
1.  **贴近生活**：大学生对二手书交易有真实需求，业务逻辑容易理解。
2.  **实体数量适中**：可以轻松设计出 6-8 个核心实体，完全满足作业要求。
3.  **功能点明确**：查询、插入、修改、删除等操作的场景非常丰富。
4.  **可扩展性强**：可以方便地加入如“心愿单”、“用户信誉”、“站内信”等高级功能，便于展示技术深度。

---
JavaWeb+Maven+GAUSS
### **核心实体（Entity）设计 (共 7 个)**

这将是你数据库概念设计（E-R图）和逻辑设计（关系模式）的基础。

1.  **用户 (User)**
    *   **描述**：系统的使用者，主要是学生。
    *   **属性**：`用户ID (UserID, 主键)`, `学号 (StudentId, 唯一)`, `昵称 (Nickname)`, `密码 (Password)`, `注册时间 (RegisterTime)`, `联系方式 (ContactInfo)`, `信誉积分 (CreditScore)`。

2.  **书籍 (Book)**
    *   **描述**：平台上的具体书籍信息。为了避免信息冗余，我们将书籍的通用信息（如ISBN、书名）和某位同学发布的具体“一本”书分开。这是标准做法。
    *   **属性**：`书籍ID (BookID, 主键)`, `ISBN (国际标准书号, 唯一)`, `书名 (Title)`, `作者 (Author)`, `出版社 (Publisher)`, `出版年份 (PublicationYear)`, `封面图片URL (CoverImageURL)`。

3.  **发布信息 (Listing)**
    *   **描述**：某个用户发布的某一本书的出售或赠送信息。这是连接“人”和“书”的核心实体。
    *   **属性**：`发布ID (ListingID, 主键)`, `发布者ID (SellerID, 外键关联User)`, `书籍ID (BookID, 外键关联Book)`, `价格 (Price)`, `新旧程度 (Condition, 如：全新、九成新)`, `发布类型 (ListingType, 枚举: 出售/赠送)`, `状态 (Status, 枚举: 在售/已预定/已售出)`, `发布时间 (PostTime)`, `描述 (Description)`。

4.  **订单 (Order)**
    *   **描述**：记录一次交易的实体。
    *   **属性**：`订单ID (OrderID, 主键)`, `发布ID (ListingID, 外键关联Listing)`, `购买者ID (BuyerID, 外键关联User)`, `下单时间 (OrderTime)`, `订单状态 (OrderStatus, 枚举: 待确认/已完成/已取消)`, `交易价格 (TransactionPrice)`。

5.  **分类 (Category)**
    *   **描述**：书籍的分类，如“计算机”、“文学”、“外语”等，方便用户按分类浏览。
    *   **属性**：`分类ID (CategoryID, 主键)`, `分类名称 (CategoryName, 唯一)`。
    *   *这个实体将与 **书籍(Book)** 实体建立多对多关系。*

6.  **书籍与分类关联表 (Book_Category)**
    *   **描述**：由于一本书可以属于多个分类（如《计算机网络》既是“计算机”又是“教材”），所以需要一个中间表来处理多对多关系。
    *   **属性**：`书籍ID (BookID, 外键)`, `分类ID (CategoryID, 外键)`。 (复合主键)

7.  **评论/留言 (Comment)**
    *   **描述**：用户可以在某个书籍发布信息下进行留言或提问。
    *   **属性**：`评论ID (CommentID, 主键)`, `发布ID (ListingID, 外键关联Listing)`, `评论者ID (UserID, 外键关联User)`, `评论内容 (Content)`, `评论时间 (CommentTime)`。

---

### **系统功能与数据操作实现 (SQL)**

根据手册要求，所有增删改查必须使用**原生 SQL 语句**实现。这部分是你在 MyBatis 的 XML 文件中要写的内容。

#### **1. 数据查询 (SELECT)**

*   **简单查询**：
    *   根据用户ID查询用户信息。
    *   根据ISBN查询书籍的基本信息。
    *   查看某个发布信息的详情。
*   **条件查询与分页**：
    *   根据书名、作者或ISBN模糊搜索书籍的发布信息。
    *   按分类浏览书籍，并按价格/发布时间排序。
    *   查询某个用户发布的所有在售书籍。
    *   查询某个用户的所有购买订单。
*   **多表连接查询 (JOIN)**：
    *   查询某个发布信息的详情时，需要连接 `Listing`, `User`, `Book` 三张表，以同时显示发布者昵称、书籍标题、价格、描述等信息。
    *   查询订单详情时，需要连接 `Order`, `Listing`, `User` (作为买家和卖家), `Book` 表。
*   **聚合查询 (GROUP BY, COUNT, AVG)**：
    *   统计每个分类下有多少本在售书籍。
    *   计算某本书的平均售价。
    *   统计某位用户的总交易额。

#### **2. 数据插入 (INSERT)**

*   用户注册：向 `User` 表插入新用户。
*   发布书籍：
    1.  首先检查 `Book` 表中是否存在该书的ISBN，如果不存在，则先向 `Book` 表插入新的书籍信息。
    2.  然后向 `Listing` 表插入一条新的发布信息。
*   创建订单：向 `Order` 表插入一条新订单。
*   发表评论：向 `Comment` 表插入一条评论。

#### **3. 数据修改 (UPDATE)**

*   用户修改个人信息（如昵称、联系方式）。
*   卖家修改发布的书籍信息（如价格、描述）。
*   卖家将书籍状态从“在售”更新为“已售出”。
*   买家或卖家更新订单状态（如从“待确认”到“已完成”）。

#### **4. 数据删除 (DELETE)**

*   用户删除自己发布的书籍信息（逻辑删除：将状态 `Status` 标记为“已下架”，而不是物理删除，这样可以保留交易记录）。
*   用户取消订单（逻辑删除：将订单状态 `OrderStatus` 标记为“已取消”）。
*   管理员删除违规评论。

---

### **触发器与存储过程设计**

这是大作业的一个重要得分点。

*   **触发器 (Trigger)**
    1.  **创建订单后更新书籍状态**：当一个订单在 `Order` 表中被创建时，触发器自动将 `Listing` 表中对应书籍的状态 `Status` 从“在售”更新为“已预定”。
    2.  **订单完成后增加用户信誉**：当一个订单的状态 `OrderStatus` 被更新为“已完成”时，触发器自动为买家和卖家的 `CreditScore` (信誉积分) 增加一定分数（例如+5分）。
    3.  **取消订单后恢复书籍状态**：当一个订单状态变为“已取消”时，触发器将 `Listing` 表中对应书籍的状态恢复为“在售”。

*   **存储过程 (Stored Procedure)**
    1.  **用户注册流程**：创建一个名为 `register_user` 的存储过程，输入参数为学号、昵称、密码等。该过程内部会检查学号是否已存在，如果不存在，则执行插入操作并返回成功信息；如果存在，则返回错误信息。
    2.  **完成交易流程**：创建一个名为 `complete_transaction` 的存储过程，输入订单ID。该过程会执行一系列原子操作：
        *   验证订单状态是否为“待确认”。
        *   更新 `Order` 表的订单状态为“已完成”。
        *   更新 `Listing` 表的发布状态为“已售出”。
        *   （通过触发器）更新买卖双方的信誉积分。
        *   所有操作在一个事务（Transaction）中完成，要么全部成功，要么全部回滚。

### **总结**

这个“校园二手书交易与分享平台”的方案，完全覆盖了你大作业指导手册中的所有要求：
*   **实体数量**：7个实体，满足6-8个的要求。
*   **功能**：查询、插入、删除、修改功能丰富。
*   **数据库设计**：涉及E-R图、关系模式、3NF规范化（例如Book和Listing的分离就是为了满足范式）。
*   **高级功能**：包含了触发器和存储过程的设计。
*   **技术实现**：所有操作都必须用原生SQL实现，非常契合MyBatis的使用方式。

然后开始进行详细的数据库设计（画E-R图、设计关系模式）和后端编码工作。
