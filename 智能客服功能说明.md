# 🤖 智能客服功能说明

## 一、功能概述

本项目集成了基于 DeepSeek 大模型的智能客服系统"小书"，为 C 端用户提供智能问答和导航服务。

### 核心功能

| 功能模块 | 说明 | 示例 |
|---------|------|------|
| **RAG 问答** | 基于使用指南文档回答平台使用问题 | "怎么发布书籍？"、"什么是信誉分？" |
| **智能搜索** | 智能区分分类搜索和关键词搜索 | "艺术类的书"→按分类筛选，"数据库"→按关键词搜索 |
| **智能导航** | 识别意图并推荐页面跳转 | "我想卖书"、"去我的订单" |
| **闲聊** | 友好回应用户 | "你好"、"谢谢" |

---

### 智能搜索详解

智能搜索会自动识别用户的搜索意图：

| 用户输入 | 识别结果 | 跳转参数 |
|---------|---------|---------|
| "有没有艺术类的书" | 分类搜索 | `categoryId=艺术分类ID` |
| "计算机类书籍" | 分类搜索 | `categoryId=计算机分类ID` |
| "有没有数据库的书" | 关键词搜索 | `keyword=数据库` |
| "找一本高等数学" | 关键词搜索 | `keyword=高等数学` |

工作原理：
1. AI 首先获取系统中所有的书籍分类
2. 分析用户输入是否提到了某个分类（如"XX类"）
3. 如果是分类搜索，匹配分类名称获取 categoryId
4. 如果是关键词搜索，提取核心关键词
5. 生成对应的跳转参数

---

## 二、技术架构

```
┌─────────────────────────────────────────────────────────────┐
│                    用户输入                                  │
│               "怎么注册账号？"                               │
└─────────────────────┬───────────────────────────────────────┘
                      │
                      ▼
┌─────────────────────────────────────────────────────────────┐
│                  意图路由器                                  │
│             (DeepSeek 分类)                                 │
│                                                             │
│    FAQ / SEARCH / NAVIGATE / CHAT                          │
└─────────────────────┬───────────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┬─────────────┐
        ▼             ▼             ▼             ▼
   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐
   │   FAQ   │  │ SEARCH  │  │NAVIGATE │  │  CHAT   │
   │         │  │         │  │         │  │         │
   │RAG问答  │  │智能搜索 │  │页面导航 │  │普通闲聊 │
   └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘
        │            │            │            │
        └────────────┴─────┬──────┴────────────┘
                           ▼
                   ┌─────────────┐
                   │  统一响应    │
                   │ + 导航按钮   │
                   └─────────────┘
```

---

## 三、文件结构

### 后端

```
SecHandBookExchange/src/main/java/com/tiancai/
├── ai/
│   ├── DeepSeekClient.java       # DeepSeek API 客户端
│   ├── RagService.java           # RAG 问答服务
│   ├── NavigationService.java    # 智能导航服务
│   └── AiAssistantService.java   # 统一 AI 服务（意图路由）
├── config/
│   └── DeepSeekConfig.java       # DeepSeek 配置类
└── controller/
    └── AiAssistantController.java # AI 接口控制器

SecHandBookExchange/src/main/resources/
├── application.yml               # 包含 DeepSeek 配置
└── docs/
    └── 使用指南.md               # RAG 知识库文档
```

### 前端

```
frontend/src/
├── api/
│   └── ai.js                     # AI API 封装
├── components/
│   └── AiAssistant.vue           # 智能客服组件
└── layouts/
    └── MainLayout.vue            # 引入客服组件
```

---

## 四、API 接口

### POST /ai/chat

智能客服对话接口。

**请求体：**
```json
{
  "message": "怎么发布书籍？"
}
```

**响应体：**
```json
{
  "code": 1,
  "msg": "success",
  "data": {
    "type": "faq",
    "message": "发布书籍的步骤如下：\n1. 登录后点击【发布书籍】\n2. 填写书籍信息...",
    "navigation": null
  }
}
```

**响应类型说明：**

| type | 说明 | navigation |
|------|------|------------|
| faq | 问答回复 | null |
| navigate | 导航/搜索 | 包含 page、params、suggestion |
| chat | 闲聊回复 | null |

---

## 五、配置说明

### application.yml

```yaml
deepseek:
  api-key: sk-xxxxx          # DeepSeek API Key
  base-url: https://api.deepseek.com
  model: deepseek-chat       # 使用的模型
```

### 更换大模型

如需更换为其他大模型（如通义千问），只需修改 `DeepSeekClient.java` 中的：
- API 地址
- 请求/响应格式

---

## 六、使用效果

用户点击右下角的"小书"按钮即可打开智能客服对话框：

- 🔍 **搜索书籍**：用户说"有没有Java的书"，系统提取关键词"Java"，提供跳转按钮
- ❓ **使用帮助**：用户问"怎么购买书籍"，系统基于 RAG 返回详细步骤
- 🚀 **快速导航**：用户说"我想卖书"，系统推荐跳转到发布页面
- 💬 **友好互动**：用户说"你好"，系统亲切回应

---

## 七、扩展建议

1. **增加向量数据库**：引入 PGVector 或 Milvus 提升 RAG 检索精度
2. **对话历史**：存储历史对话，支持多轮上下文
3. **用户反馈**：添加"有用/没用"按钮，收集反馈优化
4. **离线支持**：集成本地小模型作为降级方案

---

## 八、费用说明

DeepSeek API 价格（2024年）：
- deepseek-chat: ¥1/百万 tokens（输入）/ ¥2/百万 tokens（输出）
- 价格非常实惠，适合学习项目使用

---

> 💡 如有问题，请联系开发团队

